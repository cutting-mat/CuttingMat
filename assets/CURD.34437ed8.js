import{n as e,_ as t,d as i,b as a}from"./index.4ba80ac1.js";import"./ui.98a3144a.js";var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-table",e._b({ref:"table",attrs:{data:e.list},on:{select:function(t,i){return e.$emit("select",t,i)},"select-all":function(t){return e.$emit("select-all",t)},"selection-change":function(t){return e.$emit("selection-change",t)},"cell-mouse-enter":function(t,i,a,l){return e.$emit("cell-mouse-enter",t,i,a,l)},"cell-mouse-leave":function(t,i,a,l){return e.$emit("cell-mouse-leave",t,i,a,l)},"cell-click":function(t,i,a,l){return e.$emit("cell-click",t,i,a,l)},"cell-dblclick":function(t,i,a,l){return e.$emit("cell-dblclick",t,i,a,l)},"row-click":function(t,i,a){return e.$emit("row-click",t,i,a)},"row-contextmenu":function(t,i,a){return e.$emit("row-click",t,i,a)},"row-dblclick":function(t,i,a){return e.$emit("row-dblclick",t,i,a)},"header-click":function(t,i){return e.$emit("header-click",t,i)},"header-contextmenu":function(t,i){return e.$emit("header-contextmenu",t,i)},"sort-change":function(t,i,a){return e.$emit("sort-change",t,i,a)},"filter-change":function(t){return e.$emit("filter-change",t)},"current-change":function(t,i){return e.$emit("current-change",t,i)},"header-dragend":function(t,i,a,l){return e.$emit("header-dragend",t,i,a,l)},"expand-change":function(t,i){return e.$emit("expand-change",t,i)}}},"el-table",Object.assign({border:!0,"default-expand-all":!0,"row-key":"id"},e.tableAttribute),!1),[i("template",{slot:"append"},[e._t("append")],2),e.selectionNode&&"selection"===e.selectionNode.type?i("el-table-column",e._b({},"el-table-column",e.selectionNode,!1)):e._e(),e._l(e.columnsData,(function(t,a){return i("CURDColumn",{key:"col"+a,attrs:{column:t},scopedSlots:e._u([e._l(Object.keys(e.$scopedSlots),(function(t){return{key:t,fn:function(i){return[e._t(t,null,{column:i.column,row:i.row,prop:i.prop})]}}}))],null,!0)})}))],2),e.showPagination?i("Pagination",{attrs:{"page-size":e.queryParamFinnal.pageSize,"current-page":e.queryParamFinnal.p,"total-count":e.totalCount,"total-page":e.totalPage},on:{"current-change":e.handleCurrentChange}}):e._e(),i("el-dialog",e._b({attrs:{visible:e.dialogVisible},on:{close:e.handleCloseDialog}},"el-dialog",Object.assign({title:"详情",width:"800px","close-on-click-modal":!1,"append-to-body":!0},e.dialogAttribute),!1),[e.dialogVisible?i("CURDForm",{ref:"editForm",attrs:{model:e.modelData,default:e.editForm,action:e.editScope,formAttribute:e.formAttribute}}):e._e(),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")]),i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)},n=[];const r={props:{api:{type:Object,required:!0},model:{type:Object,required:!0,default:()=>({name:{type:"string",default:null,label:"用户名",control:"el-input",controlOption:{},scope:["create","update"],required:!1,validator:null,message:null,asynValid:!1}})},columns:{type:Array,required:!0,default:()=>[{hidden:!1,slotName:""}]},dataKey:{type:String,required:!1,default:"id"},immediate:{type:Boolean,required:!1,default:!0},queryParam:{type:Object,required:!1,default:()=>({})},getItemFromDetaiApi:{type:Boolean,required:!1,default:!1},tableAttribute:{type:Object,required:!1,default:()=>({})},dialogAttribute:{type:Object,required:!1,default:()=>({})},formAttribute:{type:Object,required:!1,default:()=>({})}},filters:{formatterFilter:(e,t,i,a,l)=>"function"==typeof l?l(t,i,e,a):e},components:{CURDForm:()=>t((()=>import("./CURDForm.0fd2f8b1.js")),["assets/CURDForm.0fd2f8b1.js","assets/CURDColumn.50182147.css","assets/index.4ba80ac1.js","assets/index.685f403a.css","assets/ui.98a3144a.js"]),CURDColumn:()=>t((()=>import("./CURDColumn.e1c646cb.js")),["assets/CURDColumn.e1c646cb.js","assets/CURDColumn.50182147.css","assets/index.4ba80ac1.js","assets/index.685f403a.css","assets/ui.98a3144a.js"])},data(){return{dialogVisible:!1,loading:!1,list:[],editForm:{},editScope:"",queryParamFinnal:{p:1,pageSize:10},totalCount:0,totalPage:0,selectionNode:null,table:{clearSelection:()=>this.$refs.table.clearSelection(),toggleRowSelection:(e,t)=>this.$refs.table.toggleRowSelection(e,t),toggleAllSelection:()=>this.$refs.table.toggleAllSelection(),toggleRowExpansion:(e,t)=>this.$refs.table.toggleRowExpansion(e,t),setCurrentRow:e=>this.$refs.table.setCurrentRow(e),clearSort:()=>this.$refs.table.clearSort(),clearFilter:e=>this.$refs.table.clearFilter(e),doLayout:()=>this.$refs.table.doLayout(),sort:(e,t)=>this.$refs.table.clearFilter(e,t)},form:{validate:e=>this.$refs.editForm.validate(e),validateField:(e,t)=>this.$refs.editForm.validateField(e,t),resetFields:()=>this.$refs.editForm.resetFields(),clearValidate:()=>this.$refs.editForm.clearValidate()}}},computed:{showPagination(){return this.list.length&&this.totalCount&&this.totalPage},modelKey(){return Object.keys(this.model)},modelData(){let e=Object.assign({},this.model);return this.modelKey.forEach((t=>{let i=Object.assign({},e[t]);e[t]=Object.assign({type:"string",default:{array:[],object:{}}[i.type]||null,control:{boolean:"el-switch",array:"DictCheckbox"}[i.type]||"el-input",scope:["create","update"],required:!!i.required},i),"el-input"===i.control&&(i.controlOption=Object.assign({maxlength:100},i.controlOption))})),e},modelValue(){let e={};return this.modelKey.map((t=>{e[t]=this.modelData[t].default})),e},columnsData(){return this.columns.filter((e=>"selection"===e.type?(this.selectionNode=Object.assign({},e),!1):!e.hidden)).map((e=>{let t=Object.assign({align:"center"},e);return"selection"!==t.type&&"expand"!==t.type||console.warn('BaseCURD组件：columns=>type属性只支持"default"和"index"'),t}))}},watch:{loading(){this.$emit("loading-state",this.loading)}},methods:{handleCurrentChange:function(e){this.queryParamFinnal.p=e,this.fetchList()},create(){this.editForm=Object.assign({},this.modelValue),this.editScope="create",this.dialogVisible=!0},update:function(e){return t=this,a=null,l=function*(){this.editForm=this.getItemFromDetaiApi?yield this.fetchDetail(e[this.dataKey]):i(e),this.editScope="update",this.dialogVisible=!0},new Promise(((e,i)=>{var n=e=>{try{o(l.next(e))}catch(t){i(t)}},r=e=>{try{o(l.throw(e))}catch(t){i(t)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,r);o((l=l.apply(t,a)).next())}));var t,a,l},save(){this.$refs.editForm.validate((e=>{if(e){let e=i(this.editForm);this.handleCloseDialog();let t=this.api[this.editScope];if("function"!=typeof t)return console.warn(`api.${this.editScope}()未定义`);this.loading=!0,t(e).then((e=>{200===e.status?(this.$message({message:"操作成功",type:"success"}),this.fetchList()):this.$message({message:"操作失败",type:"warning"})})).catch((()=>{this.loading=!1}))}}))},delete(e){if(!e||!e[this.dataKey])return console.warn(`api.delete(): 参数${this.dataKey}无效`);this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,this.api.delete({[this.dataKey]:e[this.dataKey]}).then((e=>{200===e.status?(this.fetchList(),this.$message({message:"删除成功",type:"success"})):this.$message({message:"删除失败",type:"warning"})})).catch((()=>{this.loading=!1}))})).catch((()=>{}))},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm=Object.assign({},this.modelValue)},fetchDetail:function(e){return e?(this.loading=!0,this.api.detail({[this.dataKey]:e}).then((e=>(this.loading=!1,e.data))).catch((()=>{this.loading=!1}))):console.warn(`api.detail(): 参数${this.dataKey}无效`)},fetchList:function(e){e&&(this.queryParamFinnal.p=1),this.loading=!0,this.api.list(this.queryParamFinnal).then((e=>{this.loading=!1;const t=e.data;Array.isArray(t)?this.list=a(t):Array.isArray(t.list)&&(this.list=a(t.list),this.totalCount=t.totalCount,this.totalPage=t.totalPage)})).catch((()=>{this.loading=!1}))},search(){Object.assign(this.queryParamFinnal,this.queryParam,{p:this.queryParamFinnal.p,pageSize:this.queryParamFinnal.pageSize}),this.fetchList(!0)}},created(){let e=["list","detail","create","update","delete"].filter((e=>"function"!=typeof this.api[e]));e.length&&console.warn(`${e.map((e=>"api."+e+"()")).join("、")}未定义`),this.immediate&&this.search()}},o={};var s=e(r,l,n,!1,c,"165a0364",null,null);function c(e){for(let t in o)this[t]=o[t]}var u=function(){return s.exports}();export{u as default};
