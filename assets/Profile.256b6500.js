import{e as r,d as l}from"./account.d66ddfb9.js";import{n as o}from"./index.b1e22770.js";import"./ui.62ab6f2f.js";var n=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[t("ToolBar"),e.userDetail&&e.userDetail.id?t("div",{staticClass:"infoBox wrap"},[t("uploader",{staticClass:"upload_avatar",attrs:{accept:"t-image",value:e.userDetail.avatarExt?[{url:e.userDetail.avatarExt.url}]:[],imgCrop:"","show-file-list":!1,"on-success":e.handleUpload}},[e.userDetail.avatarExt?t("img",{attrs:{src:e.userDetail.avatarExt.url,alt:""}}):t("span",[e._v("\u4E0A\u4F20\u5934\u50CF")])]),t("el-form",{attrs:{"label-width":"80px","label-position":"right",size:"small"}},[t("el-form-item",{attrs:{label:"\u7528\u6237\u540D"}},[e._v(e._s(e.userDetail.name))]),t("el-form-item",{attrs:{label:"\u5BC6\u7801"}},[t("el-button",{attrs:{type:"text"},on:{click:e.handleChangePw}},[e._v(" \u4FEE\u6539\u5BC6\u7801 "),t("i",{staticClass:"el-icon-edit"})])],1),t("el-form-item",{attrs:{label:"\u624B\u673A\u53F7"}},[e._v(e._s(e.userDetail.mobile))]),t("el-form-item",{attrs:{label:"\u6240\u5C5E\u7EC4\u7EC7"}},[e._v(e._s(e.userDetail.org&&e.userDetail.org.name))])],1),t("el-form",{ref:"validForm",attrs:{model:e.userDetail,rules:e.rules,"label-width":"80px","label-position":"right",size:"small"},nativeOn:{submit:function(a){return a.preventDefault(),function(){}.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"\u8054\u7CFB\u5730\u5740",prop:"address"}},[t("el-input",{model:{value:e.userDetail.address,callback:function(a){e.$set(e.userDetail,"address",a)},expression:"userDetail.address"}})],1),t("el-form-item",{attrs:{label:"\u4E2A\u4EBA\u4ECB\u7ECD",prop:"introduction"}},[t("el-input",{model:{value:e.userDetail.introduction,callback:function(a){e.$set(e.userDetail,"introduction",a)},expression:"userDetail.introduction"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v(" \u4FDD \u5B58 ")])],1)],1)],1):e._e(),t("auth",{ref:"auth",attrs:{types:["password","email","mobile"]}})],1)},u=[];const d={data(){return{loading:!1,userDetail:{},rules:{}}},computed:{userInfo(){return this.$store.user}},watch:{userInfo:{handler(){this.userInfo&&this.userInfo.id&&this.fetchData()},immediate:!0}},methods:{handleSubmit(){this.$refs.validForm.validate(async e=>{e&&this.doSubmit(this.userDetail)})},doSubmit(e={}){this.loading=!0,r({...this.userDetail,...e}).then(()=>{this.$store.getUser({cache:"update"}).then(()=>{this.loading=!1,this.$message.success("\u66F4\u65B0\u6210\u529F\uFF01")})}).catch(()=>{this.loading=!1})},handleUpload(e){e.id&&this.doSubmit({avatar:e.id})},handleChangePw(){this.$refs.auth.auth().then(e=>{this.$router.push({name:"\u4FEE\u6539\u5BC6\u7801",query:{authCode:e}})})},fetchData(){this.loading=!0,l({id:this.userInfo.id}).then(e=>{this.loading=!1,this.userDetail=e.data}).catch(()=>{this.loading=!1})}}},s={};var h=o(d,n,u,!1,c,"d6439722",null,null);function c(e){for(let i in s)this[i]=s[i]}var v=function(){return h.exports}();export{v as default};
