var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,l=(e,l)=>{for(var s in l||(l={}))a.call(l,s)&&i(e,s,l[s]);if(t)for(var s of t(l))r.call(l,s)&&i(e,s,l[s]);return e};import{e as s,d as o}from"./account.9880bee6.js";import{n}from"./index.edf7f234.js";import"./ui.98a3144a.js";var u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("ToolBar"),e.userDetail&&e.userDetail.id?a("div",{staticClass:"infoBox wrap"},[a("uploader",{staticClass:"upload_avatar",attrs:{accept:"t-image",value:e.userDetail.avatarExt?[{url:e.userDetail.avatarExt.url}]:[],imgCrop:"","show-file-list":!1,"on-success":e.handleUpload}},[e.userDetail.avatarExt?a("img",{attrs:{src:e.userDetail.avatarExt.url,alt:""}}):a("span",[e._v("上传头像")])]),a("el-form",{attrs:{"label-width":"80px","label-position":"right",size:"small"}},[a("el-form-item",{attrs:{label:"用户名"}},[e._v(e._s(e.userDetail.name))]),a("el-form-item",{attrs:{label:"密码"}},[a("el-button",{attrs:{type:"text"},on:{click:e.handleChangePw}},[e._v(" 修改密码 "),a("i",{staticClass:"el-icon-edit"})])],1),a("el-form-item",{attrs:{label:"手机号"}},[e._v(e._s(e.userDetail.mobile))]),a("el-form-item",{attrs:{label:"所属组织"}},[e._v(e._s(e.userDetail.org&&e.userDetail.org.name))])],1),a("el-form",{ref:"validForm",attrs:{model:e.userDetail,rules:e.rules,"label-width":"80px","label-position":"right",size:"small"},nativeOn:{submit:function(e){return e.preventDefault(),function(){}.apply(null,arguments)}}},[a("el-form-item",{attrs:{label:"联系地址",prop:"address"}},[a("el-input",{model:{value:e.userDetail.address,callback:function(t){e.$set(e.userDetail,"address",t)},expression:"userDetail.address"}})],1),a("el-form-item",{attrs:{label:"个人介绍",prop:"introduction"}},[a("el-input",{model:{value:e.userDetail.introduction,callback:function(t){e.$set(e.userDetail,"introduction",t)},expression:"userDetail.introduction"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v(" 保 存 ")])],1)],1)],1):e._e(),a("auth",{ref:"auth",attrs:{types:["password","email","mobile"]}})],1)},d=[];const h={};var c=n({data:()=>({loading:!1,userDetail:{},rules:{}}),computed:{userInfo(){return this.$store.user}},watch:{userInfo:{handler(){this.userInfo&&this.userInfo.id&&this.fetchData()},immediate:!0}},methods:{handleSubmit(){this.$refs.validForm.validate((e=>{return t=this,a=null,r=function*(){e&&this.doSubmit(this.userDetail)},new Promise(((e,i)=>{var l=e=>{try{o(r.next(e))}catch(t){i(t)}},s=e=>{try{o(r.throw(e))}catch(t){i(t)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(l,s);o((r=r.apply(t,a)).next())}));var t,a,r}))},doSubmit(e={}){this.loading=!0,s(l(l({},this.userDetail),e)).then((()=>{this.$store.getUser({cache:"update"}).then((()=>{this.loading=!1,this.$message.success("更新成功！")}))})).catch((()=>{this.loading=!1}))},handleUpload(e){e.id&&this.doSubmit({avatar:e.id})},handleChangePw(){this.$refs.auth.auth().then((e=>{this.$router.push({name:"修改密码",query:{authCode:e}})}))},fetchData(){this.loading=!0,o({id:this.userInfo.id}).then((e=>{this.loading=!1,this.userDetail=e.data})).catch((()=>{this.loading=!1}))}}},u,d,!1,m,"d6439722",null,null);function m(e){for(let t in h)this[t]=h[t]}var p=function(){return c.exports}();export{p as default};
