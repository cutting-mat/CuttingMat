var n=Object.defineProperty;var r=Object.getOwnPropertySymbols;var u=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable;var l=(e,a,t)=>a in e?n(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,s=(e,a)=>{for(var t in a||(a={}))u.call(a,t)&&l(e,t,a[t]);if(r)for(var t of r(a))d.call(a,t)&&l(e,t,a[t]);return e};import{e as h,d as c}from"./account.b46fef74.js";import{n as m}from"./index.d870fe9f.js";import"./ui.62ab6f2f.js";var p=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[t("ToolBar"),e.userDetail&&e.userDetail.id?t("div",{staticClass:"infoBox wrap"},[t("uploader",{staticClass:"upload_avatar",attrs:{accept:"t-image",value:e.userDetail.avatarExt?[{url:e.userDetail.avatarExt.url}]:[],imgCrop:"","show-file-list":!1,"on-success":e.handleUpload}},[e.userDetail.avatarExt?t("img",{attrs:{src:e.userDetail.avatarExt.url,alt:""}}):t("span",[e._v("\u4E0A\u4F20\u5934\u50CF")])]),t("el-form",{attrs:{"label-width":"80px","label-position":"right",size:"small"}},[t("el-form-item",{attrs:{label:"\u7528\u6237\u540D"}},[e._v(e._s(e.userDetail.name))]),t("el-form-item",{attrs:{label:"\u5BC6\u7801"}},[t("el-button",{attrs:{type:"text"},on:{click:e.handleChangePw}},[e._v(" \u4FEE\u6539\u5BC6\u7801 "),t("i",{staticClass:"el-icon-edit"})])],1),t("el-form-item",{attrs:{label:"\u624B\u673A\u53F7"}},[e._v(e._s(e.userDetail.mobile))]),t("el-form-item",{attrs:{label:"\u6240\u5C5E\u7EC4\u7EC7"}},[e._v(e._s(e.userDetail.org&&e.userDetail.org.name))])],1),t("el-form",{ref:"validForm",attrs:{model:e.userDetail,rules:e.rules,"label-width":"80px","label-position":"right",size:"small"},nativeOn:{submit:function(i){return i.preventDefault(),function(){}.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"\u8054\u7CFB\u5730\u5740",prop:"address"}},[t("el-input",{model:{value:e.userDetail.address,callback:function(i){e.$set(e.userDetail,"address",i)},expression:"userDetail.address"}})],1),t("el-form-item",{attrs:{label:"\u4E2A\u4EBA\u4ECB\u7ECD",prop:"introduction"}},[t("el-input",{model:{value:e.userDetail.introduction,callback:function(i){e.$set(e.userDetail,"introduction",i)},expression:"userDetail.introduction"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v(" \u4FDD \u5B58 ")])],1)],1)],1):e._e(),t("auth",{ref:"auth",attrs:{types:["password","email","mobile"]}})],1)},f=[];const v={data(){return{loading:!1,userDetail:{},rules:{}}},computed:{userInfo(){return this.$store.state.user}},watch:{userInfo:{handler(){this.userInfo&&this.userInfo.id&&this.fetchData()},immediate:!0}},methods:{handleSubmit(){this.$refs.validForm.validate(async e=>{e&&this.doSubmit(this.userDetail)})},doSubmit(e={}){this.loading=!0,h(s(s({},this.userDetail),e)).then(()=>{this.$store.action("user",{cache:"update"}).then(()=>{this.loading=!1,this.$message.success("\u66F4\u65B0\u6210\u529F\uFF01")})}).catch(()=>{this.loading=!1})},handleUpload(e){e.id&&this.doSubmit({avatar:e.id})},handleChangePw(){this.$refs.auth.auth().then(e=>{this.$router.push({name:"\u4FEE\u6539\u5BC6\u7801",query:{authCode:e}})})},fetchData(){this.loading=!0,c({id:this.userInfo.id}).then(e=>{this.loading=!1,this.userDetail=e.data}).catch(()=>{this.loading=!1})}}},o={};var _=m(v,p,f,!1,g,"5a5b87a8",null,null);function g(e){for(let a in o)this[a]=o[a]}var y=function(){return _.exports}();export{y as default};
